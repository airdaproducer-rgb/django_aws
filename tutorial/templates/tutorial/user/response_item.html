<div class="response" id="response-{{ response.id }}">
    <div class="comment-header">
        <div class="comment-author">
            {% if response.is_anonymous %}
                Anonymous
            {% else %}
                {{ response.name }}
            {% endif %}
        </div>
        <div class="comment-date">{{ response.created_at|date:"F d, Y" }}</div>
    </div>
    <div class="comment-content" id="response-content-{{ response.id }}">
        {{ response.content|linebreaks }}
    </div>
    
    <div class="comment-actions">
        <button class="action-button reply-response-button" data-response-id="{{ response.id }}" data-comment-id="{{ response.comment.id }}">
            <i class="fas fa-reply"></i> Reply
        </button>
        
        {% if user.is_authenticated and user == response.user or response.edit_token and response.edit_token in user_tokens %}
            <button class="action-button edit-response-button" data-response-id="{{ response.id }}">
                <i class="fas fa-edit"></i> Edit
            </button>
            <button class="action-button delete-response-button" data-response-id="{{ response.id }}" data-comment-id="{{ response.comment.id }}">
                <i class="fas fa-trash-alt"></i> Delete
            </button>
        {% endif %}
    </div>
    
    <div class="edit-form-container" id="edit-response-form-container-{{ response.id }}"></div>
    
    <div class="response-reply-form" id="response-reply-form-{{ response.id }}">
        <form method="POST" class="response-reply-form-element" data-url="{% url 'youtube:add_response' response.comment.id %}" data-response-id="{{ response.id }}">
            {% csrf_token %}
            <input type="hidden" name="parent_id" id="response_reply_parent_id_{{ response.id }}" value="{{ response.id }}">
            <div class="form-group">
                <label for="response_reply_id_content_{{ response.id }}">Your Reply:</label>
                <textarea name="content" class="form-control" id="response_reply_id_content_{{ response.id }}" placeholder="Write your reply..."></textarea>
                <div class="error-message" id="response_reply_content-error_{{ response.id }}"></div>
            </div>
            
            {% if not user.is_authenticated %}
                <div class="form-group">
                    <label for="response_reply_id_name_{{ response.id }}">Your Name:</label>
                    <input type="text" name="name" class="form-control" id="response_reply_id_name_{{ response.id }}" placeholder="Your name">
                    <div class="error-message" id="response_reply_name-error_{{ response.id }}"></div>
                </div>
            {% else %}
                <div class="checkbox-group">
                    <input type="checkbox" name="is_anonymous" id="response_reply_id_is_anonymous_{{ response.id }}">
                    <label for="response_reply_id_is_anonymous_{{ response.id }}">Post anonymously</label>
                </div>
            {% endif %}
            
            <button type="submit" class="submit-button">
                Post Reply
                <span class="form-spinner"></span>
            </button>
        </form>
    </div>
    
    {% if response.replies.exists %}
        <button class="action-button load-nested-responses-button" data-response-id="{{ response.id }}">
            <i class="fas fa-chevron-down"></i> <span id="nested-response-count-{{ response.id }}">
                {{ response.replies.count }} {{ response.replies.count|pluralize:"Reply,Replies" }}
            </span>
        </button>
        <div class="nested-responses-container" id="nested-responses-container-{{ response.id }}"></div>
    {% endif %}
</div>