{% extends "tutorial/user/base.html" %}

{% block title %}{{ video.title }} - MMB Tutorials{% endblock %}

{% block extra_css %}
<style>
    .video-detail {
        margin-top: 20px;
        padding: 0 10px;
        max-width: 100%;
        box-sizing: border-box;
        overflow-x: hidden;
    }
    
    .video-content-wrapper {
        display: flex;
        flex-direction: column;
        width: 100%;
    }
    
    /* Two-column layout for larger screens */
    @media (min-width: 992px) {
        .video-content-wrapper {
            flex-direction: row;
            gap: 30px;
        }
        
        .video-content {
            flex: 2;
        }
        
        .comments-section {
            flex: 1;
            margin-top: 0;
        }
    }
    
    .video-content {
        width: 100%;
    }
    
    .video-title {
        font-size: 20px;
        font-weight: 700;
        margin-bottom: 15px;
        color: var(--secondary-color);
        word-wrap: break-word;
        overflow-wrap: break-word;
        max-width: 100%;
    }
    
    .video-player-container {
        position: relative;
        width: 100%;
        padding-top: 56.25%; /* 16:9 Aspect Ratio */
        margin-bottom: 20px;
        border-radius: 8px;
        overflow: hidden;
        background-color: #000;
        box-shadow: 0 4px 10px rgba(0,0,0,0.15);
    }
    
    .video-player {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        border: none;
    }
    
    .video-description {
        background-color: white;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 30px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        line-height: 1.7;
        word-wrap: break-word;
        overflow-wrap: break-word;
        max-width: 100%;
    }
    
    @media (max-width: 768px) {
        .video-title {
            font-size: 18px;
        }
        
        .video-detail {
            padding: 0 5px;
        }
        
        .video-description {
            padding: 12px;
        }
    }
    
    @media (max-width: 480px) {
        .section-title {
            font-size: 16px;
        }
    }
</style>
{% endblock %}

{% block content %}
    <div class="video-detail">
        <h1 class="video-title">{{ video.title }}</h1>
        
        <div class="video-content-wrapper">
            <div class="video-content">
                <div class="video-player-container">
                    {% if video_id %}
                        <iframe 
                            class="video-player"
                            src="https://www.youtube.com/embed/{{ video_id }}" 
                            allowfullscreen
                        ></iframe>
                    {% else %}
                        <div class="video-player" style="background-color: #f0f0f0; display: flex; align-items: center; justify-content: center;">
                            <p>Unable to load video. Please check the URL.</p>
                        </div>
                    {% endif %}
                </div>
                
                <div class="video-description">
                    {{ video.description|linebreaks }}
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block extra_js %}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    // Function to get CSRF token from cookie
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }

    // Set up CSRF token for all AJAX POST requests
    $.ajaxSetup({
        beforeSend: function(xhr, settings) {
            if (!/^(GET|HEAD|OPTIONS|TRACE)$/i.test(settings.type) && !this.crossDomain) {
                xhr.setRequestHeader("X-CSRFToken", getCookie('csrftoken'));
            }
        }
    });
</script>
{% endblock %}